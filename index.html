<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>LIFF åˆå§‹åŒ–é é¢</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- LINE LIFF SDK -->
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

    <style>
        body {
            margin: 0;
            padding: 12px;
            font-family: system-ui, sans-serif;
            background: #fff;
            font-size: 15px;
            line-height: 1.5;
        }
        #logBox {
            width: 100%;
            min-height: 140px;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 12px;
            background: #f7f7f7;
            white-space: pre-line;
            font-size: 14px;
            margin-bottom: 20px;
        }
        #openBtn {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            background: #06c755;
            color: white;
        }
    </style>
</head>
<body>

<script>
    const WEBVIEW_URL = "https://disasterpr.fun/Game/DisasterPR_Beta1.286/index.html";
    const LIFF_ID = "2008129352-kv8pmz6V";
</script>

<h3>LIFF åˆå§‹åŒ–ç‹€æ…‹</h3>

<div id="logBox">åˆå§‹åŒ–ä¸­â€¦</div>

<button id="openBtn" disabled>é–‹å•ŸéŠæˆ²é é¢</button>

<script>
const logBox = document.getElementById("logBox");
const openBtn = document.getElementById("openBtn");

function log(msg) {
    console.log(msg);
    logBox.textContent += msg + "\n";
}

async function initApp() {
    log("ğŸ”„ åˆå§‹åŒ– LIFFâ€¦");

    try {
        await liff.init({ liffId: LIFF_ID });
        log("âœ… LIFF åˆå§‹åŒ–æˆåŠŸ");

    } catch (e) {
        log("âŒ LIFF åˆå§‹åŒ–å¤±æ•—ï¼š" + e.message);
        return;
    }

    log("ğŸ”„ å–å¾— LINE ä½¿ç”¨è€…è³‡è¨Šâ€¦");

    let uid = null;
    try {
        const profile = await liff.getProfile();
        uid = profile.userId;
        log("âœ… å–å¾— LINE IDï¼š" + uid);
    } catch (e) {
        log("âŒ ç„¡æ³•å–å¾— LINE IDï¼š" + e.message);
        return;
    }

    log("ğŸ”„ å–å¾— GPS å®šä½â€¦");

    let lat = null, lon = null;
    try {
        const loc = await liff.getCurrentLocation();
        lat = loc.latitude;
        lon = loc.longitude;

        log(`âœ… GPSï¼š${lat}, ${lon}`);

    } catch (e) {
        log("âŒ GPS å–å¾—å¤±æ•—ï¼š" + e.message);
        return;
    }

    try {
        localStorage.setItem("line_uid", uid);
        localStorage.setItem("gps_lat", lat);
        localStorage.setItem("gps_lon", lon);

        log("âœ… å·²å¯«å…¥ localStorage");
        log("ğŸ‰ æ‰€æœ‰æµç¨‹å®Œæˆï¼");

        openBtn.disabled = false;

    } catch (e) {
        log("âŒ ç„¡æ³•å¯«å…¥ localStorageï¼š" + e.message);
    }
}

openBtn.addEventListener("click", () => {
    liff.openWindow({
        url: WEBVIEW_URL,
        external: false
    });
});

initApp();
</script>

</body>
</html>
