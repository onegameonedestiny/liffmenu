<!DOCTYPE html>
<html lang="zh-Hant">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <title>LIFF åˆå§‹åŒ–é é¢</title>
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1">

Â  Â  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

Â  Â  <style>
Â  Â  Â  Â  body { margin:0; padding:12px; font-family:system-ui; }
Â  Â  Â  Â  #logBox {
Â  Â  Â  Â  Â  Â  padding:12px; background:#f4f4f4; border-radius:8px;
Â  Â  Â  Â  Â  Â  min-height:150px; white-space:pre-line; font-size:14px;
Â  Â  Â  Â  Â  Â  border:1px solid #ccc;
Â  Â  Â  Â  }
Â  Â  Â  Â  #openBtn {
Â  Â  Â  Â  Â  Â  width:100%; margin-top:20px; padding:12px;
Â  Â  Â  Â  Â  Â  background:#06c755; border:0; color:#fff;
Â  Â  Â  Â  Â  Â  border-radius:8px; font-size:16px;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>

<script>
Â  Â  const WEBVIEW_URL = "https://disasterpr.fun/Game/DisasterPR_Beta1.286/index.html";
Â  Â  const LIFF_ID = "2008129352-kv8pmz6V";
</script>

<h3>LIFF åˆå§‹åŒ–ç‹€æ…‹</h3>
<div id="logBox">æº–å‚™ä¸­â€¦</div>
<button id="openBtn" disabled>é–‹å•ŸéŠæˆ²é é¢</button>

<script>

const logBox = document.getElementById("logBox");
const openBtn = document.getElementById("openBtn");

function log(msg) { logBox.textContent += msg + "\n"; }

// ============ Web GPS ï¼ˆå„ªåŒ–éŒ¯èª¤è™•ç†ï¼‰ ============
function getWebGPS() {
Â  Â  return new Promise((resolve, reject) => {
Â  Â  Â  Â  navigator.geolocation.getCurrentPosition(
Â  Â  Â  Â  Â  Â  pos => resolve(pos.coords),
Â  Â  Â  Â  Â  Â  err => {
Â  Â  Â  Â  Â  Â  Â  Â  let errorMsg;
Â  Â  Â  Â  Â  Â  Â  Â  switch (err.code) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 1:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  errorMsg = "æ¬Šé™æ‹’çµ• (CODE 1)ï¼šè«‹æª¢æŸ¥æ‰‹æ©Ÿèˆ‡ LINE App çš„ä½ç½®æ¬Šé™æ˜¯å¦é–‹å•Ÿã€‚";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 2:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  errorMsg = "ä½ç½®ç„¡æ•ˆ (CODE 2)ï¼šç„¡æ³•åµæ¸¬åˆ° GPS è¨Šè™Ÿï¼Œè«‹ç§»å‹•åˆ°ç©ºæ› è™•ã€‚";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 3:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  errorMsg = "å®šä½è¶…æ™‚ (CODE 3)ï¼šå®šä½æ™‚é–“éä¹…ï¼Œè¨Šè™Ÿå¯èƒ½ä¸ä½³ï¼Œè«‹é‡è©¦ã€‚";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  default:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  errorMsg = `æœªçŸ¥éŒ¯èª¤ (${err.code}): ${err.message}`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  // å‚³éæ›´è©³ç´°çš„éŒ¯èª¤è¨Šæ¯çµ¦å¤–éƒ¨ catch
Â  Â  Â  Â  Â  Â  Â  Â  reject(new Error(errorMsg)); 
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  { enableHighAccuracy: true, timeout: 8000 }
Â  Â  Â  Â  );
Â  Â  });
}
// ============ Web GPS çµæŸ ============


async function initApp() {
Â  Â  log("ğŸ”„ åˆå§‹åŒ– LIFFâ€¦");

Â  Â  try {
Â  Â  Â  Â  await liff.init({ liffId: LIFF_ID });
Â  Â  Â  Â  await liff.ready;
Â  Â  Â  Â  log("âœ… LIFF åˆå§‹åŒ–å®Œæˆ");
Â  Â  } catch (e) {
Â  Â  Â  Â  log("âŒ LIFF åˆå§‹åŒ–å¤±æ•—ï¼š" + e.message);
Â  Â  Â  Â  enableButton();
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  // å–å¾— UID
Â  Â  let uid = null;
Â  Â  try {
Â  Â  Â  Â  const prof = await liff.getProfile();
Â  Â  Â  Â  uid = prof.userId;
Â  Â  Â  Â  localStorage.setItem("line_uid", uid);
Â  Â  Â  Â  log("âœ… ä½¿ç”¨è€… IDï¼š" + uid);
Â  Â  } catch (e) {
Â  Â  Â  Â  log("âš ï¸ ç„¡æ³•å–å¾—ä½¿ç”¨è€… IDï¼š" + e.message);
Â  Â  }

Â  Â  // å–å¾— GPSï¼ˆWeb ç‰ˆï¼‰
Â  Â  log("ğŸ”„ ä½¿ç”¨ Web GPS å–å¾—å®šä½â€¦");
Â  Â  try {
Â  Â  Â  Â  const gps = await getWebGPS();
Â  Â  Â  Â  localStorage.setItem("gps_lat", gps.latitude);
Â  Â  Â  Â  localStorage.setItem("gps_lon", gps.longitude);
Â  Â  Â  Â  log(`âœ… GPSï¼š${gps.latitude}, ${gps.longitude} (ç²¾æº–åº¦ç´„ ${Math.round(gps.accuracy)}m)`);
Â  Â  } catch (e) {
Â  Â  Â  Â  // é€™è£¡æœƒæ•æ‰åˆ°æˆ‘å€‘è‡ªå®šç¾©çš„è©³ç´°éŒ¯èª¤è¨Šæ¯
Â  Â  Â  Â  log("âš ï¸ Web GPS å¤±æ•—ï¼š" + e.message);
Â  Â  }

Â  Â  log("ğŸ‰ ä½œæ¥­å®Œæˆï¼Œå¯ä»¥é–‹å§‹éŠæˆ²ï¼");
Â  Â  enableButton();
}

function enableButton() {
Â  Â  openBtn.disabled = false;
}

openBtn.addEventListener("click", () => {
Â  Â  window.location.href = WEBVIEW_URL;
});

initApp();
</script>

</body>
</html>
